<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RK-Restoration</title>
    <!-- Reference your external JavaScript file here -->
    <script src="script.js"></script>
    <style>
        /* Add some basic styling for the table */
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th, td {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }

        th {
            background-color: #f2f2f2;
        }
    </style>
    <!-- Link to your custom favicon -->
    <link rel="shortcut icon" href="favicon.ico" /> 
</head>
<body>
    <h1>JSON Matching Tool</h1>

    <div>
        <label for="file1">File 1:</label>
        <textarea id="file1" placeholder="Paste your JSON here" rows="10" cols="50"></textarea>
    </div>

    <div>
        <label for="file2">File 2:</label>
        <textarea id="file2" placeholder="Paste your JSON here" rows="10" cols="50"></textarea>
    </div>

    <!-- Update the onclick to call matchJson -->
    <button onclick="matchJson()">Match JSON</button>

    <h2>Matches:</h2>
    <!-- Display matches as a table -->
    <table id="matches">
        <thead>
            <tr>
                <th>Location Name</th>
                <th>Registration Key</th>
                <th>Location ID</th>
            </tr>
        </thead>
        <tbody id="matchesBody"></tbody>
    </table>

    <!-- The rest of your JavaScript code can remain in the HTML file -->
    <script>
        // Your existing JavaScript code
        // script.js

        // Existing function for matching logic
        function matchJson() {
            const file1Input = document.getElementById('file1');
            const file2Input = document.getElementById('file2');

            // Check if textareas are not empty
            if (!file1Input.value.trim() || !file2Input.value.trim()) {
                alert('Please paste JSON into both boxes');
                return;
            }

            try {
                // Debugging: Log the input values before parsing
                console.log('File 1 content:', file1Input.value);
                console.log('File 2 content:', file2Input.value);

                const file1Data = JSON.parse(file1Input.value);
                const file2Data = JSON.parse(file2Input.value);

                // Debugging: Log the parsed data
                console.log('file1Data:', file1Data);
                console.log('file2Data:', file2Data);

                // Perform matching logic
                matchAndDisplay(file1Data, file2Data);
            } catch (error) {
                console.error('Error parsing JSON:', error);
                alert('Error parsing JSON. Please check your input.');
            }
        }

        function matchAndDisplay(file1Data, file2Data) {
            // Your existing matching and display logic
            const matches = [];

            for (const entry2 of file2Data) {
                if (entry2.body && entry2.body.targetId) {
                    const targetId = entry2.body.targetId;

                    // Updated matching logic to handle both structures in file1Data
                    const matchingEntry = file1Data.find(entry1 => entry1.id === targetId || entry1.targetId === targetId);

                    if (matchingEntry) {
                        const name = matchingEntry.name || 'N/A';
                        matches.push({
                            Name: name,
                            RelatedID: entry2.relatedId || 'N/A',
                            TargetID: targetId
                        });
                    }
                }
            }

            // Display matches as a table
            displayMatches(matches);
        }

        function displayMatches(matches) {
            const matchesBody = document.getElementById('matchesBody');
            matchesBody.innerHTML = '';

            if (matches.length === 0) {
                const noMatchesRow = document.createElement('tr');
                const noMatchesCell = document.createElement('td');
                noMatchesCell.textContent = 'No matches found.';
                noMatchesCell.colSpan = 3; // Span across all columns
                noMatchesRow.appendChild(noMatchesCell);
                matchesBody.appendChild(noMatchesRow);
            } else {
                matches.forEach(match => {
                    const row = document.createElement('tr');
                    const nameCell = document.createElement('td');
                    nameCell.textContent = match.Name;
                    const relatedIdCell = document.createElement('td');
                    relatedIdCell.textContent = match.RelatedID;
                    const targetIdCell = document.createElement('td');
                    targetIdCell.textContent = match.TargetID;

                    row.appendChild(nameCell);
                    row.appendChild(relatedIdCell);
                    row.appendChild(targetIdCell);

                    matchesBody.appendChild(row);
                });
            }
        }
    </script>
</body>
</html>
